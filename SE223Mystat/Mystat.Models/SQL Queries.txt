CREATE DATABASE SE223

USE SE223

CREATE TABLE Student
(
    Id INT PRIMARY KEY IDENTITY(1,1),
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    RegisterDate DATETIME NOT NULL DEFAULT(GETDATE()),
    FullName AS FirstName + LastName,
    Attends BIT NOT NULL,
    AttendsOnline BIT NOT NULL,
    Brilliants INT NULL,
    Comment NVARCHAR(MAX) NULL
)

CREATE PROCEDURE sp_addNewStudent
@firstName NVARCHAR(50),
@lastName NVARCHAR(50),
@attends BIT,
@attendsOnline BIT,
@brilliants INT,
@comment NVARCHAR(MAX)
AS
BEGIN
    INSERT INTO Student(FirstName,LastName,Attends,AttendsOnline,Brilliants,Comment)
    VALUES(@firstName,@lastName,@attends,@attendsOnline,@brilliants,@comment)
END



CREATE PROCEDURE sp_getAllStudents
AS
BEGIN
    SELECT
    Id,
    FirstName,
    LastName,
    RegisterDate,
    FullName,
    Attends,
    AttendsOnline,
    Brilliants,
    Comment
FROM Student
END



CREATE PROCEDURE sp_getStudentById
@id INT
AS
BEGIN
    SELECT
        Id,
        FirstName,
        LastName,
        RegisterDate,
        FullName,
        Attends,
        AttendsOnline,
        Brilliants,
        Comment
    FROM Student
    WHERE Id = @id
END





CREATE PROCEDURE sp_updateStudent
@id INT,
@firstName NVARCHAR(50),
@lastName NVARCHAR(50),
@registerDate DATETIME,
@attends BIT,
@attendsOnline BIT,
@brilliants INT,
@comment NVARCHAR(MAX)
AS
BEGIN
    UPDATE Student
    SET
        FirstName = @firstName,
        LastName = @lastName,
        RegisterDate = @registerDate,
        Attends = @attends,
        AttendsOnline = @attendsOnline,
        Brilliants = @brilliants,
        Comment = @comment
    WHERE Id = @id
END

CREATE PROCEDURE sp_deleteStudent
@id INT
AS
BEGIN
    DELETE FROM Student
    WHERE Id = @id
END






CREATE TABLE Teachers
(
	Id INT PRIMARY KEY IDENTITY NOT NULL,
	FirstName NVARCHAR(50) NOT NULL,
	LastName NVARCHAR(50) NOT NULL,
	Pin CHAR(11) NOT NULL,
	PhoneNumber CHAR(9) NOT NULL,
	Email VARCHAR(MAX) NOT NULL
)


ALTER TABLE Teachers
ADD CONSTRAINT validEmailAddress
CHECK (Email LIKE '%@%' AND Email LIKE '%.%')



CREATE PROCEDURE [dbo].[sp_addNewTeacher]
@firstName NVARCHAR(50),
@lastName NVARCHAR(50),
@pin CHAR(11),
@phoneNumber CHAR(9),
@email VARCHAR(MAX)
AS
BEGIN
    INSERT INTO Teachers(FirstName,LastName,Pin,PhoneNumber,Email)
	VALUES(@firstName,@lastName,@pin,@phoneNumber,@email)
END



CREATE PROCEDURE [dbo].[sp_updateTeacher]
@firstName NVARCHAR(50),
@lastName NVARCHAR(50),
@pin CHAR(11),
@phoneNumber CHAR(9),
@email VARCHAR(MAX),
@id INT
AS
BEGIN
	UPDATE Teachers
	SET
		FirstName = @firstName,
		LastName = @lastName,
		Pin = @pin,
		PhoneNumber = @phoneNumber,
		Email = @email
	WHERE Id = @id
END


CREATE PROCEDURE sp_deleteTeacher
@id INT
AS
BEGIN
	DELETE
	FROM Teachers
	WHERE Id=@id;
END


CREATE PROCEDURE sp_getTeacherById
@id INT
AS
BEGIN
SELECT [Id]
      ,[FirstName]
      ,[LastName]
      ,[Pin]
      ,[PhoneNumber]
      ,[Email]
  FROM [SE223].[dbo].[Teachers]
  WHERE Id = @id
END


CREATE PROCEDURE sp_getAllTeachers
AS
BEGIN
SELECT [Id]
      ,[FirstName]
      ,[LastName]
      ,[Pin]
      ,[PhoneNumber]
      ,[Email]
  FROM [SE223].[dbo].[Teachers]
END



CREATE TABLE Subjects(
	[Id] INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	[Title] [nvarchar](100) NOT NULL
)







CREATE PROCEDURE sp_getAllSubjects
AS
BEGIN
	SELECT
		Id,
		Title
	FROM Subjects
END


CREATE PROCEDURE sp_getSubjectById
@id INT
AS
BEGIN
	SELECT
		Id,
		Title
	FROM Subjects
	WHERE Id = @id
END


CREATE PROCEDURE sp_addNewSubject
@title NVARCHAR(100)
AS
BEGIN
	INSERT INTO Subjects(Title)
	VALUES(@title)
END


CREATE PROCEDURE sp_deleteSubject
@id INT
AS
BEGIN
	DELETE
	FROM Subjects
	WHERE Id = @id
END

CREATE PROCEDURE sp_updateSubject
@title NVARCHAR(100),
@id INT
AS
BEGIN
	UPDATE Subjects
	SET Title = @title
	WHERE Id = @id
END








CREATE TABLE Groups
(
    Name VARCHAR(100) NOT NULL,
	SubjectId INT FOREIGN KEY REFERENCES Subjects(Id),
	TeacherId INT FOREIGN KEY REFERENCES Teachers(Id),
	StudentId INT FOREIGN KEY REFERENCES Student(Id),
)


CREATE PROCEDURE sp_addGroup
@name VARCHAR(100),
@subjectId INT,
@teacherId INT,
@studentId INT
AS
BEGIN
	INSERT INTO Groups(Name,SubjectId,TeacherId,StudentId)
	VALUES(@name,@subjectId,@teacherId,@studentId)
END



CREATE PROCEDURE [dbo].[sp_updateSubjectForGroup]
@groupName VARCHAR(100),
@existingSubjectId INT,
@subjectId INT
AS
BEGIN
	UPDATE Groups
	SET SubjectId =@subjectId
	WHERE SubjectId = @existingSubjectId AND Name = @groupName
END



CREATE PROCEDURE [dbo].[sp_updateTeacherForGroup]
@groupName VARCHAR(100),
@teacherId INT,
@existingTeacherId INT
AS
BEGIN
	UPDATE Groups
	SET TeacherId =@teacherId
	WHERE TeacherId = @existingTeacherId  AND [Name] = @groupName
END



CREATE PROCEDURE [dbo].[sp_updateStudentForGroup]
@existingStudentId INT,
@studentId INT,
@groupName VARCHAR(100)
AS
BEGIN
    UPDATE Groups
    SET StudentId = @studentId
    WHERE StudentId = @existingStudentId AND [Name]=@groupName
END



CREATE PROCEDURE [dbo].[sp_deleteStudentForGroup]
@studentId INT,
@groupName VARCHAR(100)
AS
BEGIN
    DELETE FROM Groups
    WHERE StudentId = @studentId AND [Name] = @groupName
END



CREATE PROCEDURE sp_deleteGroup
@name VARCHAR(100)
AS
BEGIN
    DELETE FROM Groups
    WHERE Name = @name
END